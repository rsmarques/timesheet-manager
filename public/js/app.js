!function(){"use strict";angular.module("app",["app.controllers","app.services","app.routes","app.config"]);angular.module("app.routes",["ui.router","ngStorage"]),angular.module("app.controllers",["ui.router","ngMaterial","ngResource","ngMessages","ngStorage"]),angular.module("app.services",[]),angular.module("app.config",[])}(),function(){"use strict";angular.module("app.config").config(["$mdIconProvider",function(e){e.fontSet("md","material-icons")}]).config(["$mdThemingProvider",function(e){e.theme("dark-grey").backgroundPalette("grey").dark(),e.theme("dark-orange").backgroundPalette("orange").dark(),e.theme("dark-purple").backgroundPalette("deep-purple").dark(),e.theme("dark-blue").backgroundPalette("blue").dark()}]).constant("API_URL","api/")}(),function(){"use strict";angular.module("app.routes").config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,t,r){e.state("signup",{url:"/signup",templateUrl:"./views/app/auth/auth.html",controller:"AuthCtrl",register:1}).state("signin",{url:"/signin",templateUrl:"./views/app/auth/auth.html",controller:"AuthCtrl",register:0}).state("logout",{url:"/logout",templateUrl:"./views/app/auth/auth.html",controller:"AuthCtrl",logout:1}).state("users",{url:"/users",templateUrl:"./views/app/users/user.html",controller:"UserCtrl"}).state("worksheets",{url:"/",templateUrl:"./views/app/worksheets/worksheet.html",controller:"WorksheetCtrl"}),t.otherwise("/"),r.interceptors.push(["$q","$location","$localStorage",function(e,t,r){return{request:function(e){return e.headers=e.headers||{},r.token&&(e.headers.Authorization="Bearer "+r.token),e},responseError:function(r){return 400!==r.status&&401!==r.status&&403!==r.status||t.path("/signin"),e.reject(r)}}}])}])}(),function(){"use strict";angular.module("app.controllers").controller("AuthCtrl",["$rootScope","$scope","$state","$location","$localStorage","AuthSrv",function(e,t,r,n,o,s){function i(e){o.token=e.token,window.location="#/"}t.performLogin=function(){return t.register?t.signup():t.signin()},t.performLogout=function(){s.logout(function(){window.location="#/signin"})},t.signin=function(){var e=t.credentials;t.authError=null,s.signin(e,i,function(){t.authError="Invalid email/password."})},t.signup=function(){var e=t.credentials;t.authError=null,s.signup(e,i,function(e){e.errors&&e.errors[0]?t.authError=e.errors[0]:t.authError="Failed to signup"})},t.$on("$stateChangeSuccess",function(){t.logout=r.current.logout,t.logout&&t.performLogout(),t.register=r.current.register,t.loginText=t.register?"Register":"Login",t.authError=null}),t.token=o.token,t.tokenClaims=s.getTokenClaims(),t.credentials={}}])}(),angular.module("app.services").factory("AuthSrv",["$http","API_URL","$localStorage",function(e,t,r){function n(e){var t=e.replace("-","+").replace("_","/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return window.atob(t)}function o(){var e=r.token,t={};if("undefined"!=typeof e){var o=e.split(".")[1];t=JSON.parse(n(o))}return t}var s=o();return{signup:function(r,n,o){e.post(t+"users/signup",r).success(n).error(o)},signin:function(r,n,o){e.post(t+"users/signin",r).success(n).error(o)},logout:function(e){s={},delete r.token,e()},getTokenClaims:function(){return s}}}]),function(){"use strict";angular.module("app.controllers").controller("UserCtrl",["$scope","mdDialogSrv","UserSrv",function(e,t,r){e.getProfile=function(){r.me({},function(t){e.currentUser=t.data},function(e){})},e.openEditProfileDialog=function(r){t.fromTemplate("./views/app/dialogs/edit_user.html",r,e)},e.getProfile()}])}(),angular.module("app.services").factory("UserSrv",["$resource","API_URL",function(e,t){return e(t+"users/:id",{},{me:{url:t+"me",method:"GET"},getUsers:{method:"GET",params:{id:"@id"}},get:{method:"GET",params:{id:"@id"}},create:{method:"POST",params:{id:"@id",email:"@email",password:"@password",first_name:"@first_name",last_name:"@last_name",username:"@username",profile_image:"@profile_image",role:"@role",working_hours:"@working_hours"}},update:{method:"PUT",params:{id:"@id",email:"@email",password:"@password",first_name:"@first_name",last_name:"@last_name",username:"@username",profile_image:"@profile_image",role:"@role",working_hours:"@working_hours"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),function(){"use strict";angular.module("app.controllers").controller("WorksheetCtrl",["$scope","mdMenuSrv","mdDialogSrv","mdToastSrv","WorksheetSrv","UserSrv",function(e,t,r,n,o,s){e.openMenu=function(e,r){t.openMenu(e,r)},e.openDeleteWorksheetDialog=function(t,n){var o={title:"Are you sure you want to delete this worksheet?",textContent:"This action cannot be undone",ariaLabel:"deleteWorksheet",ok:"Yes",cancel:"Cancel"};r.confirm(t,o,function(t){e.deleteWorksheet(n)},function(e){})},e.openEditUserDialog=function(t){r.fromTemplate("./views/app/dialogs/edit_user.html",t,e)},e.openEditWorksheetDialog=function(t,n){e.currentWorksheet=n,n.date&&(e.currentWorksheet.dateJS=new Date(n.date)),r.fromTemplate("./views/app/dialogs/edit_worksheet.html",t,e)},e.worksheetFilter=function(){return function(t){return(!e.filters.start_date||new Date(t.date)>=e.filters.start_date)&&(!e.filters.end_date||new Date(t.date)<=e.filters.end_date)}},e.selectUser=function(t){e.worksheets=[],e.currentUser=t,o.userWorksheets({userId:t.id},function(t){e.worksheets=t.data},function(e){})},e.sortUsers=function(t,r){e.userSort=t,e.userSortReverse=r},e.deleteWorksheet=function(t){return!!t.id&&void o["delete"]({id:t.id},function(r){var o=e.worksheets.indexOf(t);o!==-1&&e.worksheets.splice(o,1),n.show({content:"Worksheet Deleted!",position:"top right",delay:3e3})},function(e){})},e.cancelEditUser=function(){r.cancel()},e.finishEditUser=function(t){e.saveUser(t),r.hide()},e.saveUser=function(e){var t=e.id?"update":"create";s[t](e,function(e){},function(e){})},e.cancelEditWorksheet=function(){r.cancel()},e.finishEditWorksheet=function(){e.saveWorksheet(),r.hide()},e.saveWorksheet=function(){var t=e.currentWorksheet.id?"update":"create";e.currentWorksheet.user_id=e.currentWorksheet.user_id?e.currentWorksheet.user_id:e.currentUser.id,e.currentWorksheet.date=e.currentWorksheet.dateJS?e.currentWorksheet.dateJS.toISOString().substring(0,10):e.currentWorksheet.date,e.currentWorksheet.new_note&&e.createNote(),o[t](e.currentWorksheet,function(t){var r=t.data,o=e.worksheets.map(function(e){return e.id}).indexOf(r.id);if(o===-1){var s=JSON.parse(JSON.stringify(r));e.worksheets.unshift(s),n.show({content:"Successfully Created Worksheet!",position:"top right",delay:3e3})}},function(e){n.err({content:"Error Editing Worksheet!",position:"top right",delay:3e3})})},e.deleteNote=function(t){return e.currentWorksheet.notes.splice(t,1),!0},e.createNote=function(){return!!e.currentWorksheet.new_note&&(e.currentWorksheet.notes||(e.currentWorksheet.notes=[]),e.currentWorksheet.notes.push(e.currentWorksheet.new_note),e.currentWorksheet.new_note=null,!0)},s.getUsers({},function(t){e.users=t.data},function(e){}),e.filters={}}])}(),angular.module("app.services").factory("WorksheetSrv",["$resource","API_URL",function(e,t){return e(t+"worksheets/:id",{},{userWorksheets:{url:t+"user/:userId/worksheets",method:"GET",params:{id:"@id"}},get:{method:"GET",params:{id:"@id"}},create:{method:"POST",params:{id:"@id",date:"@date",hours:"@hours",user_id:"@user_id",notes:"@notes"}},update:{method:"PUT",params:{id:"@id",date:"@date",hours:"@hours",user_id:"@user_id",notes:"@notes"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),angular.module("app.services").factory("mdDialogSrv",["$mdDialog",function(e){return{fromTemplate:function(t,r,n){var o={templateUrl:t,targetEvent:r,clickOutsideToClose:!0};return n&&(o.scope=n.$new()),e.show(o)},hide:function(){return e.hide()},cancel:function(){return e.cancel()},alert:function(t,r){e.show(e.alert().title(t).content(r).ok("Ok"))},confirm:function(t,r,n,o){var s=e.confirm().title(r.title).textContent(r.textContent).ariaLabel(r.ariaLabel).targetEvent(t).ok(r.ok).cancel(r.cancel);e.show(s).then(n,o)}}}]),angular.module("app.services").service("mdMenuSrv",function(){return{openMenu:function(e,t){originatorEv=t,e(t)}}}),angular.module("app.services").factory("mdToastSrv",["$mdToast",function(e){return{show:function(t){return e.show(e.simple().content(t.content).position(t.position).hideDelay(t.delay))},error:function(t){return e.show(e.simple().content(t.content).position(t.position).theme("warn").hideDelay(t.delay))}}}]);