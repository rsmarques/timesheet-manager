!function(){"use strict";angular.module("app",["app.controllers","app.services","app.routes","app.config"]);angular.module("app.routes",["ui.router","ngStorage"]),angular.module("app.controllers",["ui.router","ngMaterial","ngResource","ngMessages","ngStorage"]),angular.module("app.services",[]),angular.module("app.config",[])}(),function(){"use strict";angular.module("app.config").config(["$mdIconProvider",function(e){e.fontSet("md","material-icons")}]).config(["$mdThemingProvider",function(e){e.theme("dark-grey").backgroundPalette("grey").dark(),e.theme("dark-orange").backgroundPalette("orange").dark(),e.theme("dark-purple").backgroundPalette("deep-purple").dark(),e.theme("dark-blue").backgroundPalette("blue").dark()}]).constant("API_URL","api/")}(),function(){"use strict";angular.module("app.routes").config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,t,r){e.state("signup",{url:"/signup",templateUrl:"./views/app/auth/auth.html",controller:"AuthCtrl",register:1}).state("signin",{url:"/signin",templateUrl:"./views/app/auth/auth.html",controller:"AuthCtrl",register:0}).state("logout",{url:"/logout",templateUrl:"./views/app/auth/auth.html",controller:"AuthCtrl",logout:1}).state("users",{url:"/users",templateUrl:"./views/app/users/user.html",controller:"UserCtrl"}).state("worksheets",{url:"/",templateUrl:"./views/app/worksheets/worksheet.html",controller:"WorksheetCtrl"}),t.otherwise("/"),r.interceptors.push(["$q","$location","$localStorage",function(e,t,r){return{request:function(e){return e.headers=e.headers||{},r.token&&(e.headers.Authorization="Bearer "+r.token),e},responseError:function(r){return 400!==r.status&&401!==r.status&&403!==r.status||t.path("/signin"),e.reject(r)}}}])}])}(),function(){"use strict";angular.module("app.controllers").controller("AuthCtrl",["$rootScope","$scope","$state","$location","$localStorage","AuthSrv",function(e,t,r,n,o,s){function i(e){o.token=e.token,window.location="#/"}t.performLogin=function(){return t.register?t.signup():t.signin()},t.performLogout=function(){s.logout(function(){window.location="#/signin"})},t.signin=function(){var e=t.credentials;t.authError=null,s.signin(e,i,function(){t.authError="Invalid email/password."})},t.signup=function(){var e=t.credentials;t.authError=null,s.signup(e,i,function(e){e.errors&&e.errors[0]?t.authError=e.errors[0]:t.authError="Failed to signup"})},t.$on("$stateChangeSuccess",function(){t.logout=r.current.logout,t.logout&&t.performLogout(),t.register=r.current.register,t.loginText=t.register?"Register":"Login",t.authError=null}),t.token=o.token,t.tokenClaims=s.getTokenClaims(),t.credentials={}}])}(),angular.module("app.services").factory("AuthSrv",["$http","API_URL","$localStorage",function(e,t,r){function n(e){var t=e.replace("-","+").replace("_","/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return window.atob(t)}function o(){var e=r.token,t={};if("undefined"!=typeof e){var o=e.split(".")[1];t=JSON.parse(n(o))}return t}var s=o();return{signup:function(r,n,o){e.post(t+"users/signup",r).success(n).error(o)},signin:function(r,n,o){e.post(t+"users/signin",r).success(n).error(o)},logout:function(e){s={},delete r.token,e()},getTokenClaims:function(){return s}}}]),function(){"use strict";angular.module("app.controllers").controller("UserCtrl",["$rootScope","$scope","mdDialogSrv","UserSrv",function(e,t,r,n){t.getProfile=function(){n.me({},function(t){e.me=t.data},function(e){})},t.openEditProfileDialog=function(n){t.currentUser=e.me,r.fromTemplate("./views/app/dialogs/edit_user.html",n,t)},t.openNewProfileDialog=function(e){t.currentUser={},r.fromTemplate("./views/app/dialogs/edit_user.html",e,t)},t.getProfile()}])}(),angular.module("app.services").factory("UserSrv",["$resource","API_URL",function(e,t){return e(t+"users/:id",{},{me:{url:t+"me",method:"GET"},getUsers:{method:"GET",params:{id:"@id"}},get:{method:"GET",params:{id:"@id"}},create:{method:"POST",params:{id:"@id",email:"@email",password:"@password",first_name:"@first_name",last_name:"@last_name",username:"@username",profile_image:"@profile_image",role:"@role",working_hours:"@working_hours"}},update:{method:"PUT",params:{id:"@id",email:"@email",password:"@password",first_name:"@first_name",last_name:"@last_name",username:"@username",profile_image:"@profile_image",role:"@role",working_hours:"@working_hours"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),function(){"use strict";angular.module("app.controllers").controller("WorksheetCtrl",["$rootScope","$scope","mdMenuSrv","mdDialogSrv","mdToastSrv","WorksheetSrv","UserSrv",function(e,t,r,n,o,s,i){t.openMenu=function(e,t){r.openMenu(e,t)},t.openDeleteWorksheetDialog=function(e,r){var o={title:"Are you sure you want to delete this worksheet?",textContent:"This action cannot be undone",ariaLabel:"deleteWorksheet",ok:"Yes",cancel:"Cancel"};n.confirm(e,o,function(e){t.deleteWorksheet(r)},function(e){})},t.openDeleteUserDialog=function(e,r){var o={title:"Are you sure you want to delete this user?",textContent:"This action cannot be undone",ariaLabel:"deleteUser",ok:"Yes",cancel:"Cancel"};n.confirm(e,o,function(e){t.deleteUser(r)},function(e){})},t.openEditUserDialog=function(e){n.fromTemplate("./views/app/dialogs/edit_user.html",e,t)},t.openEditWorksheetDialog=function(e,r){t.canEditWorksheet(r),t.currentWorksheet=r,r.date&&(t.currentWorksheet.dateJS=new Date(r.date)),n.fromTemplate("./views/app/dialogs/edit_worksheet.html",e,t)},t.worksheetFilter=function(){return function(e){return(!t.filters.start_date||new Date(e.date)>=t.filters.start_date)&&(!t.filters.end_date||new Date(e.date)<=t.filters.end_date)}},t.selectUser=function(e){t.worksheets=[],t.currentUser=e,s.userWorksheets({userId:e.id},function(e){t.worksheets=e.data},function(e){})},t.sortUsers=function(e,r){t.userSort=e,t.userSortReverse=r},t.deleteWorksheet=function(e){return!!e.id&&void s["delete"]({id:e.id},function(r){var n=t.worksheets.indexOf(e);n!==-1&&t.worksheets.splice(n,1),o.show({content:"Worksheet Deleted!",position:"top right",delay:3e3})},function(e){})},t.deleteUser=function(e){return!!e.id&&void i["delete"]({id:e.id},function(r){var n=t.users.indexOf(e);return n!==-1&&t.users.splice(n,1),e.id==t.me.id?(window.location="#/logout",!0):(t.currentUser=null,void o.show({content:"User Deleted!",position:"top right",delay:3e3}))},function(e){})},t.cancelEditUser=function(){n.cancel()},t.finishEditUser=function(e){t.saveUser(e),n.hide()},t.saveUser=function(e){var r=e.id?"update":"create";i[r](e,function(e){var r=e.data,n=t.users.map(function(e){return e.id}).indexOf(r.id);if(n===-1){var s=JSON.parse(JSON.stringify(r));t.users.unshift(s),o.show({content:"Successfully Created User!",position:"top right",delay:3e3})}},function(e){})},t.cancelEditWorksheet=function(){n.cancel()},t.finishEditWorksheet=function(){t.saveWorksheet(),n.hide()},t.saveWorksheet=function(){var e=t.currentWorksheet.id?"update":"create";t.currentWorksheet.user_id=t.currentWorksheet.user_id?t.currentWorksheet.user_id:t.currentUser.id,t.currentWorksheet.date=t.currentWorksheet.dateJS?t.currentWorksheet.dateJS.toISOString().substring(0,10):t.currentWorksheet.date,t.currentWorksheet.new_note&&t.createNote(),s[e](t.currentWorksheet,function(e){var r=e.data,n=t.worksheets.map(function(e){return e.id}).indexOf(r.id);if(n===-1){var s=JSON.parse(JSON.stringify(r));t.worksheets.unshift(s),o.show({content:"Successfully Created Worksheet!",position:"top right",delay:3e3})}},function(e){o.error({content:"Error Editing Worksheet!",position:"top right",delay:3e3})})},t.deleteNote=function(e){return t.currentWorksheet.notes.splice(e,1),!0},t.createNote=function(){return!!t.currentWorksheet.new_note&&(t.currentWorksheet.notes||(t.currentWorksheet.notes=[]),t.currentWorksheet.notes.push(t.currentWorksheet.new_note),t.currentWorksheet.new_note=null,!0)},t.canEditWorksheet=function(r){return"Admin"===e.me.role||t.currentUser.id==e.me.id},t.hasAdminAccess=function(){return"Admin"===e.me.role||"Manager"===e.me.role},t.getUsers=function(){i.getUsers({},function(e){t.users=e.data},function(e){})},t.getUsers(),t.filters={},t.currentUser={}}])}(),angular.module("app.services").factory("WorksheetSrv",["$resource","API_URL",function(e,t){return e(t+"worksheets/:id",{},{userWorksheets:{url:t+"user/:userId/worksheets",method:"GET",params:{id:"@id"}},get:{method:"GET",params:{id:"@id"}},create:{method:"POST",params:{id:"@id",date:"@date",hours:"@hours",user_id:"@user_id",notes:"@notes"}},update:{method:"PUT",params:{id:"@id",date:"@date",hours:"@hours",user_id:"@user_id",notes:"@notes"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),angular.module("app.services").factory("mdDialogSrv",["$mdDialog",function(e){return{fromTemplate:function(t,r,n){var o={templateUrl:t,targetEvent:r,clickOutsideToClose:!0};return n&&(o.scope=n.$new()),e.show(o)},hide:function(){return e.hide()},cancel:function(){return e.cancel()},alert:function(t,r){e.show(e.alert().title(t).content(r).ok("Ok"))},confirm:function(t,r,n,o){var s=e.confirm().title(r.title).textContent(r.textContent).ariaLabel(r.ariaLabel).targetEvent(t).ok(r.ok).cancel(r.cancel);e.show(s).then(n,o)}}}]),angular.module("app.services").service("mdMenuSrv",function(){return{openMenu:function(e,t){originatorEv=t,e(t)}}}),angular.module("app.services").factory("mdToastSrv",["$mdToast",function(e){return{show:function(t){return e.show(e.simple().content(t.content).position(t.position).hideDelay(t.delay))},error:function(t){return e.show(e.simple().content(t.content).position(t.position).theme("warn").hideDelay(t.delay))}}}]);